apiVersion: tekton.dev/v1beta1
kind: Pipeline
metadata:
  name: kubeconfig-creator-pipeline
spec:
  workspaces:
    - name: source
  tasks:
    - name: kubeconfig-creator
      taskRef:
        resolver: cluster
        params:
        - name: kind
          value: task
        - name: name
          value: kubeconfig-creator
        - name: namespace
          value: openshift-pipelines
      workspaces:
      - name: output
        workspace: source 
      params:
        - name: name
          value: cluster-bot
        - name: username
          value: kubeadmin
        - name: url
          value: https://api.com:6443
        - name: password
          value: password
        - name: insecure
          value: true
    - name: view-config
      taskSpec:
        steps:
        - name: test
          image: quay.io/openshift/origin-cli:4.6
          script: |
            export KUBECONFIG="$(workspaces.input.path)/$(inputs.params.filename)"
            oc config view
      workspaces:
        - name: input
          workspace: source
      params:
        - name: filename
          value: kubeconfig
      runAfter:
        - kubeconfig-creator